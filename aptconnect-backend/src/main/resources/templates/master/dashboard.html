<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}" lang="KO">

<title>Master Dashboard</title>

<!--ì¶”ê°€ ìŠ¤íƒ€ì¼ ì‚½ì…-->
<th:block layout:fragment="styles">
    <style>
        .chart-container { width: 100%; /* ê°€ë¡œëŠ” 100% ê½‰ ì°¨ê²Œ */ max-width: none; /* ìµœëŒ€ í¬ê¸° ì œí•œ */ height: 20vh; /* í™”ë©´ ë†’ì´ì˜ 20% */ min-height: 300px; /* ë„ˆë¬´ ì‘ì•„ì§€ì§€ ì•Šë„ë¡ ìµœì†Œ ë†’ì´ ì„¤ì • */ text-align: center; margin-top: 20px; }
        .chart-container canvas{ display: block; margin: auto; width: 100% !important; height: 100% !important; }
    </style>
</th:block>

<div layout:fragment="navbar">
    <div th:replace="~{/master/navbar :: navbar}"></div>
</div>

<!-- ğŸ”¹ ë³¸ë¬¸ ì˜ì—­ -->
<div layout:fragment="main-content">
    <div class="container mt-4">
        <div class="row">
            <div class="col-md-6"> <!-- ì‚¬ìš©ì í˜„í™© ì°¨íŠ¸ -->
                <div class="card mb-4">
                    <div class="card-header">ì‚¬ìš©ì í˜„í™©</div>
                    <div class="card-body">
                        <div class="card-body chart-container">
                            <canvas id="userStatusChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-6"> <!-- ì›”ë³„ ì‚¬ìš©ì ë“±ë¡ ì°¨íŠ¸ -->
                <div class="card mb-4">
                    <div class="card-header">ì›”ë³„ ì‚¬ìš©ì ë“±ë¡ í˜„í™©</div>
                    <div class="card-body">
                        <div class="card-body chart-container">
                            <canvas id="monthlyUserChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-6"> <!-- ì•„íŒŒíŠ¸ ë“±ë¡ í˜„í™© ì°¨íŠ¸ -->
                <div class="card mb-4">
                    <div class="card-header">ì•„íŒŒíŠ¸ ë“±ë¡ í˜„í™©</div>
                    <div class="card-body">
                        <div class="card-body chart-container">
                            <canvas id="apartmentStatusChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-6"> <!-- ì›”ë³„ ì•„íŒŒíŠ¸ ë“±ë¡ ì°¨íŠ¸ -->
                <div class="card mb-4">
                    <div class="card-header">ì›”ë³„ ì•„íŒŒíŠ¸ ë“±ë¡ í˜„í™©</div>
                    <div class="card-body">
                        <div class="card-body chart-container">
                            <canvas id="monthlyApartmentChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-12">
                <div class="card mb-4">
                    <div class="card-header">ì¼ë³„ ë¡œê·¸ ë°œìƒ ìˆ˜<</div>
                    <div class="card-body">
                        <div class="card-body chart-container">
                            <canvas id="dailyLogChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<th:block layout:fragment="scripts">
    <!-- Thymeleaf ë°ì´í„° ë³€í™˜ -->
    <script th:inline="javascript">
        /*<![CDATA[*/
        let userStatusData = /*[[${userStatus}]]*/ {};
        let monthlyData = /*[[${monthlyUserRegistration}]]*/ {};
        let apartmentStatusData = /*[[${apartmentStatus}]]*/ {};
        let monthlyApartmentData = /*[[${monthlyApartmentRegistration}]]*/ {};

        userStatusData = userStatusData || {};
        monthlyData = monthlyData || {};
        apartmentStatusData = apartmentStatusData || {};
        monthlyApartmentData = monthlyApartmentData || {};

        function ensureDefaultData(data, defaultValue) {
            return Object.keys(data).length > 0 ? data : defaultValue;
        }

        // ê¸°ë³¸ ë°ì´í„° ì„¤ì •
        userStatusData = ensureDefaultData(userStatusData, { "ì—†ìŒ": 0 });
        monthlyData = ensureDefaultData(monthlyData, { "1ì›”": 0, "2ì›”": 0, "3ì›”": 0, "4ì›”": 0, "5ì›”": 0, "6ì›”": 0 });
        apartmentStatusData = ensureDefaultData(apartmentStatusData, { "ì—†ìŒ": 0 });
        monthlyApartmentData = ensureDefaultData(monthlyApartmentData, { "1ì›”": 0, "2ì›”": 0, "3ì›”": 0, "4ì›”": 0, "5ì›”": 0, "6ì›”": 0 });
        /*]]>*/
    </script>

    <!-- ì‚¬ìš©ì í˜„í™© ì°¨íŠ¸ (Pie Chart) -->
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            var ctxUserStatus = document.getElementById('userStatusChart').getContext('2d');

            new Chart(ctxUserStatus, {
                type: 'pie',
                data: {
                    labels: Object.keys(userStatusData),
                    datasets: [{
                        data: Object.values(userStatusData),
                        backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false, // ë¹„ìœ¨ ê°•ì œ ìœ ì§€ í•´ì œ
                    aspectRatio: 3, // ê°€ë¡œ ê³µê°„ í™•ë³´
                    plugins: {
                        legend: {
                            position: 'right', // ë²”ë¡€ë¥¼ ì˜¤ë¥¸ìª½ìœ¼ë¡œ ì´ë™
                        }
                    }
                }
            });
        });
    </script>

    <!-- ì›”ë³„ ì‚¬ìš©ì ë“±ë¡ ì°¨íŠ¸ (Line Chart) -->
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            var ctxMonthlyUser = document.getElementById('monthlyUserChart').getContext('2d');

            new Chart(ctxMonthlyUser, {
                type: 'line',
                data: {
                    labels: Object.keys(monthlyData),
                    datasets: [{
                        label: 'ì›”ë³„ ì‚¬ìš©ì ë“±ë¡ ìˆ˜',
                        data: Object.values(monthlyData),
                        borderColor: '#36A2EB',
                        fill: false,
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,  // ë¹„ìœ¨ ì¡°ì • ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì •
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        });
    </script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            var ctxApartmentStatus = document.getElementById('apartmentStatusChart').getContext('2d');

            new Chart(ctxApartmentStatus, {
                type: 'pie',
                data: {
                    labels: Object.keys(apartmentStatusData),
                    datasets: [{
                        data: Object.values(apartmentStatusData),
                        backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    aspectRatio: 3,
                    plugins: {
                        legend: {
                            position: 'right',
                        }
                    }
                }
            });

            var ctxMonthlyApartment = document.getElementById('monthlyApartmentChart').getContext('2d');

            new Chart(ctxMonthlyApartment, {
                type: 'line',
                data: {
                    labels: Object.keys(monthlyApartmentData),
                    datasets: [{
                        label: 'ì›”ë³„ ì•„íŒŒíŠ¸ ë“±ë¡ ìˆ˜',
                        data: Object.values(monthlyApartmentData),
                        borderColor: '#36A2EB',
                        fill: false,
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        });
    </script>
    <script th:inline="javascript">
        /*<![CDATA[*/
        var dailyLogData = /*[[${dailyLogCounts}]]*/ {};

        document.addEventListener("DOMContentLoaded", function () {
            var ctxDailyLog = document.getElementById('dailyLogChart').getContext('2d');

            new Chart(ctxDailyLog, {
                type: 'line',
                data: {
                    labels: Object.keys(dailyLogData), // ë‚ ì§œ ë¦¬ìŠ¤íŠ¸
                    datasets: [{
                        label: 'ì¼ë³„ ë¡œê·¸ ë°œìƒ ìˆ˜',
                        data: Object.values(dailyLogData), // ë¡œê·¸ ê°œìˆ˜ ë¦¬ìŠ¤íŠ¸
                        borderColor: '#FF6384',
                        fill: false,
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        });
        /*]]>*/
    </script>
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</th:block>